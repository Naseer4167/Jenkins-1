pipeline {
    agent any
    environment {
        AWS_REGION = 'us-east-1' // Change this to your AWS region
        STACK_NAME = 'MyJenkinsStackName' // Name of your CloudFormation stack
        TEMPLATE_FILE = 'cloudformation.yaml' // Path to your CloudFormation template
        AWS_CREDENTIALS_ID = '764a34d6-357d-4fdb-9c3e-fe8925968a89' // Jenkins credential ID for AWS
    }
    stages {
        stage('Checkout Code') {
            steps {
                // Clone the repository containing your CloudFormation template
                git branch: 'main', url: 'https://github.com/Naseer4167/Jenkins-1.git'
            }
        }
        stage('Validate Template') {
            steps {
                withAWS(credentials: AWS_CREDENTIALS_ID, region: AWS_REGION) {
                    sh """
                    aws cloudformation validate-template --template-body file://${TEMPLATE_FILE}
                    """
                }
            }
        }
        stage('Create/Update Stack') {
            steps {
                withAWS(credentials: AWS_CREDENTIALS_ID, region: AWS_REGION) {
                    sh """
                    aws cloudformation deploy \
                        --stack-name ${STACK_NAME} \
                        --template-file ${TEMPLATE_FILE} \
                        --capabilities CAPABILITY_NAMED_IAM
                    """
                }
            }
        }
    }
    post {
        success {
            echo 'CloudFormation stack deployed successfully!'
        }
        failure {
            echo 'Deployment failed. Check the logs for errors.'
        }
    }
}
